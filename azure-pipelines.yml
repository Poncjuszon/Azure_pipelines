
trigger: none

pool:
  vmImage: 'windows-latest'

parameters:
  - name: environment
    displayName: Environment
    type: string
    values:
      - PROD
      - UAT
      - QA
      - INT
  - name: roles
    displayName: Role in environment
    type: object

variables:
  - template: envs/${{ parameters.environment }}.yaml

stages:
  - stage: Publish
    displayName: Publish content of src directory to Artifactory
    jobs:
      - job: publish
        steps:
          - script: |
              dir
              hostname
              echo $(System.DefaultWorkingDirectory)
              echo "koniec"
          - publish: '$(System.DefaultWorkingDirectory)/src'
            artifact: 'Apps'

  - stage: Deploy_to_environment
    displayName: 'Copy files to Apps directory'
    jobs:
      - job: test_variable
        steps:
          - script: echo dupa 
          # ${{ variables }}
          - script: echo dupa2 ${{ variables.web_rootCM }}
      - deployment: deployment
        displayName: "Deployment"
        environment: 
          name: ${{ parameters.environment }}
          tags: SITECORE
          resourceType: virtualMachine
        strategy:
          runOnce:
            deploy:
              steps:
                - task: CopyFiles@2
                  inputs:
                    SourceFolder: '$(System.DefaultWorkingDirectory)\..\Apps\'
                    Contents: '**'
                    TargetFolder: 'd:\DigitlHubCM'
                    OverWrite: true
